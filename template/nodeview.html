<div class="container" style="margin-top:50px">
    <div class="row">
        <div id="container" class="col-xs-8"></div>
        <div class="col-xs-4">
            <form class="form-group" action="/nodemodify/{{.ID}}" method="post">
                <div class="form-group row">
                    <label for="id" class="col-xs-4 col-form-label">ID</label>
                    <div class="col-xs-8">
                        <p class="form-control-static mb-0"> {{ .ID }} </p>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="species" class="col-xs-4 col-form-label">种类</label>
                    <div class="col-xs-8">
                        <input class="form-control" type="search" value="{{ .Species }}" id="species" name="species" disabled>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="max" class="col-xs-4 col-form-label">最大报警值ֵ</label>
                    <div class="col-xs-8">
                        <input class="form-control" type="search" value="{{ .MaxValue }}" id="max" name="max" disabled>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="min" class="col-xs-4 col-form-label">最小报警值ֵ</label>
                    <div class="col-xs-8">
                        <input class="form-control" type="search" value="{{ .MinValue }}" id="min" name="min" disabled>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="X" class="col-xs-4 col-form-label">X</label>
                    <div class="col-xs-8">
                        <input class="form-control" type="search" value="{{ .X }}" id="X" name="X" disabled>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="Y" class="col-xs-4 col-form-label">Y</label>
                    <div class="col-xs-8">
                        <input class="form-control" type="search" value="{{ .Y }}" id="Y" name="Y" disabled>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="describe" class="col-xs-4 col-form-label">描述</label>
                    <div class="col-xs-8">
                        <input class="form-control" type="search" value="{{ .Describe }}" id="describe" name="describe" disabled>
                    </div>
                </div>
                <button id="submit" class="btn btn-warning " type="submit" disabled>提交</button>
                <div clsss="offset-md-10 ">
                    <button type="button" class="btn btn-primary " onclick="history()">查看历史</button>
                    <button type="button" class="btn btn-primary " onclick="modify()">修改</button>


                    <button id="delete" type="button" class="btn btn-danger " onclick="deletenode()" disabled>删除该节</button>
                </div>
            </div>

        </div>

    </div>

</div>
<script>
    var id = {{ .ID }};
    var data = [2, 5, 2, 7, 4, 8, 9, 3];
    var chart;

    function history() {
        location.href = '/nodehistory/' + id;
    }

    function deletenode() {
        post('/delete/{{ .ID}}', {name: 'Johnny Bravo'});
    }

    function post(path, params, method) {
        method = method || "post"; // Set method to post by default if not specified.

        // The rest of this code assumes you are not using a library.
        // It can be made less wordy if you use one.
        var form = document.createElement("form");
        form.setAttribute("method", method);
        form.setAttribute("action", path);

        for(var key in params) {
            if(params.hasOwnProperty(key)) {
                var hiddenField = document.createElement("input");
                hiddenField.setAttribute("type", "hidden");
                hiddenField.setAttribute("name", key);
                hiddenField.setAttribute("value", params[key]);
                form.appendChild(hiddenField);
             }
         }

         document.body.appendChild(form);
         form.submit();
    }

    function modify() {
        $("#species ").removeAttr('disabled');
        $("#max ").removeAttr('disabled');
        $("#min ").removeAttr('disabled');
        $("#describe ").removeAttr('disabled');
        $("#X").removeAttr('disabled');
        $("#Y").removeAttr('disabled');
        $("#submit").removeAttr('disabled');
        $("#delete").removeAttr('disabled');
    }


    function requestData() {
        $.ajax({
            url: '/nodeseries/' + id,
            success: function(point) {
                var series = chart.series[0],
                    shift = series.data.length > 20; // shift if the series is
                // longer than 20

                // add the point
                chart.series[0].addPoint(point, true, shift);
                // call it again after one second
                setTimeout(requestData, 1000);
            },
            cache: false
        });

    }

    function sleep(delay) {
        var start = new Date().getTime();
        while (new Date().getTime() < start + delay);

    }

    $(document).ready(function() {

        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                defaultSeriesType: 'spline',
                events: {
                    load: requestData
                }
            },
            title: {
                text: '实时数据'
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150,
                maxZoom: 10
            },
            yAxis: {
                minPadding: 0.2,
                maxPadding: 0.2,
                title: {
                    text: 'Value',
                    margin: 80
                }
            },
            series: [{
                name: '{{.Species}}',
                data: []
            }]
        });
    });

</script>
